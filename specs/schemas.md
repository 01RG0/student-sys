### Data models

- **Student**
  - `studentId` (string) required, unique key
  - `fullName` (string)
  - `grade` (string) e.g., "Senior 1"
  - `className` (string) optional
  - `registrationStatus` (string: "registered" | "not_registered" | "unknown")
  - `homeworkStatus` (string: "done" | "not_done" | "unknown")
  - `lastUpdatedAt` (ISO string)

- **Node**
  - `nodeId` (string) generated by Manager per connection
  - `name` (string) user-provided e.g., "Black-1"
  - `role` (string: "manager" | "first_scan" | "last_scan")

- **Event: StudentRecord** (sent by First Scan)
  - `type`: "student_record"
  - `payload`:
    - `studentId`: string
    - `registrationStatus`: string
    - `homeworkStatus`: string
    - `comment` (string, optional) free text note provided at registration
    - `source`: { `nodeName`, `nodeId` }
    - `ts`: ISO string

- **Cache**
  - `version` (number, monotonically increasing)
  - `students` (array<Student>)

### Example messages (WebSocket)

```json
{"type":"register","node":{"name":"Black-1","role":"first_scan"},"token":"optional-token"}
```

```json
{"type":"cache_request"}
```

```json
{"type":"cache","version":3,"students":[{"studentId":"1001","fullName":"Alice","grade":"Senior 1","registrationStatus":"registered","homeworkStatus":"done","lastUpdatedAt":"2025-09-14T10:00:00Z"}]}
```

```json
{"type":"cache_update","version":4,"students":[...]} 
```

```json
{"type":"student_record","payload":{"studentId":"1001","registrationStatus":"registered","homeworkStatus":"done","source":{"nodeName":"Black-1","nodeId":"abc"},"ts":"2025-09-14T10:02:00Z"}}
```

```json
{"type":"cache_ack","version":4}
```

### Storage formats

- `storage/students_cache.json` → `{ version:number, students: Student[] }`
- `storage/events.jsonl` → one JSON per line of StudentRecord events
- `storage/state.json` → aggregate latest per `studentId`

### Excel → JSON mapping

- Columns auto-detected by case-insensitive headers:
  - `student id` | `id` → `studentId`
  - `name` | `full name` → `fullName`
  - `grade` → `grade`
  - `class` → `className`
  - `registration` → `registrationStatus`
  - `homework` → `homeworkStatus`


